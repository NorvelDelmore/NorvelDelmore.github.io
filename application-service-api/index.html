

<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.119.0">
<meta name="robots" content="index, follow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Application Service API | Matrix Specification</title>
<meta name="description" content="The Matrix client-server API and server-server APIs provide the means to implement a consistent self-contained federated messaging fabric. However, they provide limited means of implementing custom server-side behaviour in Matrix (e.g. gateways, filters, extensible hooks etc). The Application Service API (AS API) defines a standard API to allow such extensible functionality to be implemented irrespective of the underlying homeserver implementation.
Application Services Application services are passive and can only observe events from the homeserver.">
<meta property="og:title" content="Application Service API" />
<meta property="og:description" content="The Matrix client-server API and server-server APIs provide the means to implement a consistent self-contained federated messaging fabric. However, they provide limited means of implementing custom server-side behaviour in Matrix (e.g. gateways, filters, extensible hooks etc). The Application Service API (AS API) defines a standard API to allow such extensible functionality to be implemented irrespective of the underlying homeserver implementation.
Application Services Application services are passive and can only observe events from the homeserver." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/application-service-api/" /><meta property="article:section" content="" />


<meta itemprop="name" content="Application Service API">
<meta itemprop="description" content="The Matrix client-server API and server-server APIs provide the means to implement a consistent self-contained federated messaging fabric. However, they provide limited means of implementing custom server-side behaviour in Matrix (e.g. gateways, filters, extensible hooks etc). The Application Service API (AS API) defines a standard API to allow such extensible functionality to be implemented irrespective of the underlying homeserver implementation.
Application Services Application services are passive and can only observe events from the homeserver.">

<meta itemprop="wordCount" content="6101">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Application Service API"/>
<meta name="twitter:description" content="The Matrix client-server API and server-server APIs provide the means to implement a consistent self-contained federated messaging fabric. However, they provide limited means of implementing custom server-side behaviour in Matrix (e.g. gateways, filters, extensible hooks etc). The Application Service API (AS API) defines a standard API to allow such extensible functionality to be implemented irrespective of the underlying homeserver implementation.
Application Services Application services are passive and can only observe events from the homeserver."/>




<link rel="preload" href="/scss/main.min.af4c3a756149c6e6a38a514505696051afd07c3cc0ac1bb64498d5cd0c8f613b.css" as="style">
<link href="/scss/main.min.af4c3a756149c6e6a38a514505696051afd07c3cc0ac1bb64498d5cd0c8f613b.css" rel="stylesheet" integrity="">

<script
  src="/js/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK">
</script>



<link rel="preload" href="/css/fonts/Inter.css" as="style">
<link rel="stylesheet" href="/css/fonts/Inter.css">




<link rel="preload" href="/scss/custom.min.e7010c4aa0015f690b91b7b50c35f1a5f21ea69d2fe93db6b124deb2722a2dcf.css" as="style">
<link href="/scss/custom.min.e7010c4aa0015f690b91b7b50c35f1a5f21ea69d2fe93db6b124deb2722a2dcf.css" rel="stylesheet" integrity="">


  </head>
  <body class="td-page">
    <header>
      


<nav class="js-navbar-scroll navbar navbar-expand navbar-light flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg width="75" height="32" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="nonzero"><path d="M.936.732V31.25H3.13v.732H.095V0h3.034v.732zm8.45 9.675v1.544h.044a4.461 4.461.0 011.487-1.368c.58-.323 1.245-.485 1.993-.485.72.0 1.377.14 1.972.42.595.279 1.047.771 1.355 1.477.338-.5.796-.941 1.377-1.323.58-.383 1.266-.574 2.06-.574.602.0 1.16.074 1.674.22.514.148.954.383 1.322.707.366.323.653.746.859 1.268.205.522.308 1.15.308 1.887v7.633H20.71v-6.464c0-.383-.015-.743-.044-1.082a2.305 2.305.0 00-.242-.882 1.473 1.473.0 00-.584-.596c-.257-.146-.606-.22-1.047-.22-.44.0-.796.085-1.068.253-.272.17-.485.39-.639.662a2.654 2.654.0 00-.308.927 7.074 7.074.0 00-.078 1.048v6.354h-3.128v-6.398c0-.338-.007-.673-.021-1.004a2.825 2.825.0 00-.188-.916 1.411 1.411.0 00-.55-.673c-.258-.168-.636-.253-1.135-.253a2.33 2.33.0 00-.584.1 1.94 1.94.0 00-.705.374c-.228.184-.422.449-.584.794-.161.346-.242.798-.242 1.357v6.619H6.434V10.407h2.952zm16.456 1.677a3.751 3.751.0 011.233-1.17 5.37 5.37.0 011.685-.629 9.579 9.579.0 011.884-.187c.573.0 1.153.04 1.74.121.588.081 1.124.24 1.609.475.484.235.88.562 1.19.981.308.42.462.975.462 1.666v5.934c0 .516.03 1.008.088 1.478.058.471.161.824.308 1.06H32.87a4.435 4.435.0 01-.22-1.104c-.5.515-1.087.876-1.762 1.081a7.084 7.084.0 01-2.071.31c-.544.0-1.05-.067-1.52-.2a3.472 3.472.0 01-1.234-.617 2.87 2.87.0 01-.826-1.059c-.199-.426-.298-.934-.298-1.522.0-.647.114-1.18.342-1.6.227-.419.52-.753.881-1.004.36-.25.771-.437 1.234-.562.462-.125.929-.224 1.399-.298.47-.073.932-.132 1.387-.176.456-.044.86-.11 1.212-.199.353-.088.631-.217.837-.386.206-.169.301-.415.287-.74.0-.337-.055-.606-.166-.804a1.217 1.217.0 00-.44-.464 1.737 1.737.0 00-.639-.22 5.292 5.292.0 00-.782-.055c-.617.0-1.101.132-1.454.397-.352.264-.558.706-.617 1.323h-3.128c.044-.735.227-1.345.55-1.83zm6.179 4.423a5.095 5.095.0 01-.639.165 9.68 9.68.0 01-.716.11c-.25.03-.5.067-.749.11a5.616 5.616.0 00-.694.177 2.057 2.057.0 00-.594.298c-.17.125-.305.284-.408.474-.103.192-.154.434-.154.728.0.28.051.515.154.706.103.192.242.342.419.453.176.11.381.187.617.231.234.044.477.066.726.066.617.0 1.094-.102 1.432-.309.338-.205.587-.452.75-.739.16-.286.26-.576.297-.87.036-.295.055-.53.055-.707v-1.17a1.4 1.4.0 01-.496.277zm11.863-6.1v2.096h-2.291v5.647c0 .53.088.883.264 1.059.176.177.529.265 1.057.265.177.0.345-.007.507-.022.161-.015.316-.037.463-.066v2.426a7.49 7.49.0 01-.882.089 21.67 21.67.0 01-.947.022c-.484.0-.944-.034-1.377-.1a3.233 3.233.0 01-1.145-.386 2.04 2.04.0 01-.782-.816c-.191-.353-.287-.816-.287-1.39v-6.728H36.57v-2.096h1.894v-3.42h3.129v3.42h2.29zm4.471.0v2.118h.044a3.907 3.907.0 011.454-1.754 4.213 4.213.0 011.036-.497 3.734 3.734.0 011.145-.176c.206.0.433.037.683.11v2.912a5.862 5.862.0 00-.528-.077 5.566 5.566.0 00-.595-.033c-.573.0-1.058.096-1.454.287a2.52 2.52.0 00-.958.783 3.143 3.143.0 00-.518 1.158 6.32 6.32.0 00-.154 1.434v5.14h-3.128V10.407h2.973zM54.039 8.642V6.06h3.128v2.582H54.04zm3.128 1.765v11.405H54.04V10.407h3.128zm1.63.0h3.569l2.005 2.978 1.982-2.978h3.459l-3.745 5.339 4.208 6.067h-3.57l-2.378-3.596-2.38 3.596h-3.502l4.097-6.001zM74.094 31.25V.732H71.9V0h3.035v31.982H71.9v-.732z"/></g></svg></span><span class="font-weight-bold">specification</span><span class="navbar-version"> &mdash; unstable version</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">

			<li class="nav-item mr-4 mb-2 mb-lg-0"><a href="https://matrix.org/foundation/">Foundation</a>
			</li>

      <li class="nav-item mr-4 mb-2 mb-lg-0"><a href="https://matrix.org/faq/">FAQs</a>
			</li>

      <li class="nav-item mr-4 mb-2 mb-lg-0"><a href="https://matrix.org/blog/posts">Blog</a>
      </li>

			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"></div>
</nav>




    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-3 td-sidebar d-print-none">
            
<div id="td-sidebar-menu" class="td-sidebar__inner">
  <div id="content-mobile">
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  </div>
  <div id="content-desktop"></div>
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m--li">
  <a href="/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-"><span class="">Matrix Specification</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-client-server-api-li">
  <a href="/client-server-api/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-client-server-api"><span class="">Client-Server API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-server-server-api-li">
  <a href="/server-server-api/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-server-server-api"><span class="">Server-Server API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-application-service-api-li">
  <a href="/application-service-api/" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id="m-application-service-api"><span class="td-sidebar-nav-active-item">Application Service API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-identity-service-api-li">
  <a href="/identity-service-api/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-identity-service-api"><span class="">Identity Service API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-push-gateway-api-li">
  <a href="/push-gateway-api/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-push-gateway-api"><span class="">Push Gateway API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-rooms-li">
  <a href="/rooms/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-rooms"><span class="">Room Versions</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-roomsv1-li">
  <a href="/rooms/v1/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-roomsv1"><span class="">Room Version 1</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-roomsv2-li">
  <a href="/rooms/v2/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-roomsv2"><span class="">Room Version 2</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-roomsv3-li">
  <a href="/rooms/v3/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-roomsv3"><span class="">Room Version 3</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-roomsv4-li">
  <a href="/rooms/v4/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-roomsv4"><span class="">Room Version 4</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-roomsv5-li">
  <a href="/rooms/v5/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-roomsv5"><span class="">Room Version 5</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-roomsv6-li">
  <a href="/rooms/v6/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-roomsv6"><span class="">Room Version 6</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-roomsv7-li">
  <a href="/rooms/v7/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-roomsv7"><span class="">Room Version 7</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-roomsv8-li">
  <a href="/rooms/v8/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-roomsv8"><span class="">Room Version 8</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-roomsv9-li">
  <a href="/rooms/v9/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-roomsv9"><span class="">Room Version 9</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-roomsv10-li">
  <a href="/rooms/v10/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-roomsv10"><span class="">Room Version 10</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-roomsv11-li">
  <a href="/rooms/v11/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-roomsv11"><span class="">Room Version 11</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-proposals-li">
  <a href="/proposals/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-proposals"><span class="">Spec Change Proposals</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-appendices-li">
  <a href="/appendices/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-appendices"><span class="">Appendices</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-changelog-li">
  <a href="/changelog/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-changelog"><span class="">Changelog</span></a>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </div>
          <main class="col-12 col-md-9 col-xl-7 pl-md-5" role="main">
            






<div class="pageinfo pageinfo-primary pageinfo-unstable">
  <p>You're looking at an unstable version of this specification.
  Unstable specifications may change at any time without notice.</p>
  <p><a href="https://spec.matrix.org/latest">Switch to the current stable release</a>.</p>
</div>


            


<nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">





<li class="breadcrumb-item" >
	<a href="/">Matrix Specification</a>
</li>



<li class="breadcrumb-item active" aria-current="page">
	<a href="/application-service-api/">Application Service API</a>
</li>

	</ol>
</nav	>




            
<div class="td-content">
	<h1>Application Service API</h1>
	<p>The Matrix client-server API and server-server APIs provide the means to
implement a consistent self-contained federated messaging fabric.
However, they provide limited means of implementing custom server-side
behaviour in Matrix (e.g. gateways, filters, extensible hooks etc). The
Application Service API (AS API) defines a standard API to allow such
extensible functionality to be implemented irrespective of the
underlying homeserver implementation.</p>
<h2 id="application-services">Application Services</h2>
<p>Application services are passive and can only observe events from the
homeserver. They can inject events into rooms they are participating in.
They cannot prevent events from being sent, nor can they modify the
content of the event being sent. In order to observe events from a
homeserver, the homeserver needs to be configured to pass certain types
of traffic to the application service. This is achieved by manually
configuring the homeserver with information about the application
service.</p>
<h3 id="registration">Registration</h3>
<div class="alert note " role="alert">
Previously, application services could register with a homeserver via
HTTP APIs. This was removed as it was seen as a security risk. A
compromised application service could re-register for a global <code>*</code> regex
and sniff <em>all</em> traffic on the homeserver. To protect against this,
application services now have to register via configuration files which
are linked to the homeserver configuration file. The addition of
configuration files allows homeserver admins to sanity check the
registration for suspicious regex strings.
</div>
<p>Application services register &ldquo;namespaces&rdquo; of user IDs, room aliases and
room IDs. An application service is said to be &ldquo;interested&rdquo; in a given event
if it matches any of the namespaces.</p>
<p>An application service can also state whether they should be the only
ones who can manage a specified namespace. This is referred to as an
&ldquo;exclusive&rdquo; namespace. An exclusive namespace prevents humans and other
application services from creating/deleting entities in that namespace.
Typically, exclusive namespaces are used when the rooms represent real
rooms on another service (e.g. IRC). Non-exclusive namespaces are used
when the application service is merely augmenting the room itself (e.g.
providing logging or searching facilities).</p>
<p>The registration is represented by a series of key-value pairs, which
is normally encoded as an object in a YAML file. It has the following structure:</p>
<section class="rendered-data definition" id="definition-registration">
<details open>
<summary>
<h1>
 <code>Registration</code>
</h1>
</summary>
<hr/>
<table class="object-table">
 <caption>Registration</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>as_token</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>A secret token that the application service will use to authenticate requests to the homeserver.</td>
 </tr>
 <tr>
  <td><code>hs_token</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>A secret token that the homeserver will use authenticate requests to the application service.</td>
 </tr>
 <tr>
  <td><code>id</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>A unique, user-defined ID of the application service which will never change.</td>
 </tr>
 <tr>
  <td><code>namespaces</code></td>
  <td><code>Namespaces</code></td>
  <td>
    <strong>Required: </strong>The namespaces that the application service is interested in.</td>
 </tr>
 <tr>
  <td><code>protocols</code></td>
  <td><code>[string]</code></td>
  <td>
    The external protocols which the application service provides (e.g. IRC).</td>
 </tr>
 <tr>
  <td><code>rate_limited</code></td>
  <td><code>boolean</code></td>
  <td>
    Whether requests from masqueraded users are rate-limited. The sender is excluded.</td>
 </tr>
 <tr>
  <td><code>sender_localpart</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The localpart of the user associated with the application service.</td>
 </tr>
 <tr>
  <td><code>url</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The URL for the application service. May include a path after the domain name. Optionally set to null if no traffic is required.</td>
 </tr>
</table>
<table class="object-table">
 <caption>Namespaces</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>aliases</code></td>
  <td><code>[Namespace]</code></td>
  <td>
    A list of namespaces defining the room aliases that the application
service is interested in. All events sent in a room with an alias
which matches one of the namespaces will be sent to the AS.</td>
 </tr>
 <tr>
  <td><code>rooms</code></td>
  <td><code>[Namespace]</code></td>
  <td>
    A list of namespaces defining the room IDs that the application
service is interested in. All events sent in a room with an ID
which matches one of the namespaces will be sent to the AS.</td>
 </tr>
 <tr>
  <td><code>users</code></td>
  <td><code>[Namespace]</code></td>
  <td>
    A list of namespaces defining the user IDs that the application
service is interested in. Events will be sent to the AS if a
local user matching one of the namespaces is the target of the event,
or is a joined member of the room where the event occurred.</td>
 </tr>
</table>
<table class="object-table">
 <caption>Namespace</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>exclusive</code></td>
  <td><code>boolean</code></td>
  <td>
    <strong>Required: </strong>A true or false value stating whether this application service has exclusive access to events within this namespace.</td>
 </tr>
 <tr>
  <td><code>regex</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>A POSIX regular expression defining which values this namespace includes.</td>
 </tr>
</table>
<h2>Examples</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;namespaces&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;aliases&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;rooms&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;users&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;protocols&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></section>
<p>Exclusive user and alias namespaces should begin with an underscore
after the sigil to avoid collisions with other users on the homeserver.
Application services should additionally attempt to identify the service
they represent in the reserved namespace. For example, <code>@_irc_.*</code> would
be a good namespace to register for an application service which deals
with IRC.</p>
<p>An example registration file for an IRC-bridging application service is
below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;IRC Bridge&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;http://127.0.0.1:1234&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">as_token</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;30c05ae90a248a4188e620216fa72e349803310ec83e2a77b34fe90be6081f46&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">hs_token</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;312df522183efd404ec1cd22d2ffa4bbc76a8c1ccf541dd692eef281356bb74e&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">sender_localpart</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;_irc_bot&#34;</span><span class="w"> </span><span class="c"># Will result in @_irc_bot:example.org</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">namespaces</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">users</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">exclusive</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">regex</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;@_irc_bridge_.*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">aliases</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">exclusive</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">regex</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#_irc_bridge_.*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rooms</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span></span></span></code></pre></div><div class="alert note " role="alert">
<p>For the <code>users</code> namespace, application services can only register interest in
<em>local</em> users (i.e., users whose IDs end with the <code>server_name</code> of the local
homeserver). Events affecting users on other homeservers are not sent to an application
service, even if the user happens to match the one of the <code>users</code> namespaces (unless,
of course, the event affects a room that the application service is interested in
for another room - for example, because there is another user in the room that the
application service is interested in).</p>
<p>For the <code>rooms</code> and <code>aliases</code> namespaces, all events in a matching room will be
sent to the application service.</p>
</div>
<div class="alert warning " role="alert">
If the homeserver in question has multiple application services, each
<code>as_token</code> and <code>id</code> MUST be unique per application service as these are
used to identify the application service. The homeserver MUST enforce
this.
</div>
<h3 id="homeserver--gt-application-service-api">Homeserver -&gt; Application Service API</h3>
<h4 id="authorization">Authorization</h4>
<p><span><strong>[Changed in <code>v1.4</code>]</strong></span></p>
<p>Homeservers MUST include an <code>Authorization</code> header, containing the <code>hs_token</code>
from the application service&rsquo;s registration, when making requests to the
application service. Application services MUST verify that the provided
<code>Bearer</code> token matches their known <code>hs_token</code>, failing the request with
an <code>M_FORBIDDEN</code> error if it does not match.</p>
<p>The format of the <code>Authorization</code> header is similar to the <a href="/client-server-api/#client-authentication">Client-Server API</a>:
<code>Bearer TheHSTokenGoesHere</code>.</p>
<div class="alert note " role="alert">
<p>In previous versions of this specification, an <code>access_token</code> query
parameter was used instead. Servers should only send this query parameter
if supporting legacy versions of the specification.</p>
<p>If sending the <code>query_string</code>, it is encouraged to send it alongside
the <code>Authorization</code> header for maximum compatibility.</p>
<p>Application services should ensure both match if both are provided.</p>
</div>
<h4 id="legacy-routes">Legacy routes</h4>
<p>Previous drafts of the application service specification had a mix of
endpoints that have been used in the wild for a significant amount of
time. The application service specification now defines a version on all
endpoints to be more compatible with the rest of the Matrix
specification and the future.</p>
<p>Homeservers should attempt to use the specified endpoints first when
communicating with application services. However, if the application
service receives an HTTP status code that does not indicate success
(i.e.: 404, 500, 501, etc) then the homeserver should fall back to the
older endpoints for the application service.</p>
<p>The older endpoints have the exact same request body and response
format, they just belong at a different path. The equivalent path for
each is as follows:</p>
<ul>
<li><code>/_matrix/app/v1/transactions/{txnId}</code> should fall back to
<code>/transactions/{txnId}</code></li>
<li><code>/_matrix/app/v1/users/{userId}</code> should fall back to
<code>/users/{userId}</code></li>
<li><code>/_matrix/app/v1/rooms/{roomAlias}</code> should fall back to
<code>/rooms/{roomAlias}</code></li>
<li><code>/_matrix/app/v1/thirdparty/protocol/{protocol}</code> should fall back to
<code>/_matrix/app/unstable/thirdparty/protocol/{protocol}</code></li>
<li><code>/_matrix/app/v1/thirdparty/user/{user}</code> should fall back to
<code>/_matrix/app/unstable/thirdparty/user/{user}</code></li>
<li><code>/_matrix/app/v1/thirdparty/location/{location}</code> should fall back to
<code>/_matrix/app/unstable/thirdparty/location/{location}</code></li>
<li><code>/_matrix/app/v1/thirdparty/user</code> should fall back to
<code>/_matrix/app/unstable/thirdparty/user</code></li>
<li><code>/_matrix/app/v1/thirdparty/location</code> should fall back to
<code>/_matrix/app/unstable/thirdparty/location</code></li>
</ul>
<p>Homeservers should periodically try again for the newer endpoints
because the application service may have been updated.</p>
<h4 id="unknown-routes">Unknown routes</h4>
<p>If a request for an unsupported (or unknown) endpoint is received then the server
must respond with a 404 <code>M_UNRECOGNIZED</code> error.</p>
<p>Similarly, a 405 <code>M_UNRECOGNIZED</code> error is used to denote an unsupported method
to a known endpoint.</p>
<h4 id="pushing-events">Pushing events</h4>
<p>The application service API provides a transaction API for sending a
list of events. Each list of events includes a transaction ID, which
works as follows:</p>
<pre tabindex="0"><code>    Typical
    HS ---&gt; AS : Homeserver sends events with transaction ID T.
       &lt;---    : Application Service sends back 200 OK.
</code></pre><pre tabindex="0"><code>    AS ACK Lost
    HS ---&gt; AS : Homeserver sends events with transaction ID T.
       &lt;-/-    : AS 200 OK is lost.
    HS ---&gt; AS : Homeserver retries with the same transaction ID of T.
       &lt;---    : Application Service sends back 200 OK. If the AS had processed these
                 events already, it can NO-OP this request (and it knows if it is the
                 same events based on the transaction ID).
</code></pre><p>The events sent to the application service should be linearised, as if
they were from the event stream. The homeserver MUST maintain a queue of
transactions to send to the application service. If the application
service cannot be reached, the homeserver SHOULD backoff exponentially
until the application service is reachable again. As application
services cannot <em>modify</em> the events in any way, these requests can be
made without blocking other aspects of the homeserver. Homeservers MUST
NOT alter (e.g. add more) events they were going to send within that
transaction ID on retries, as the application service may have already
processed the events.</p>
<section class="rendered-data http-api PUT">
<details open>
<summary>
  <h1 id="put_matrixappv1transactionstxnid">
   <span class="http-api-method PUT">PUT</span>
   <span class="endpoint">/_matrix/app/v1/transactions/{txnId}</span>
  </h1>
</summary>
  <hr/>
<p><p>This API is called by the homeserver when it wants to push an event
(or batch of events) to the application service.</p>
<p>Note that the application service should distinguish state events
from message events via the presence of a <code>state_key</code>, rather than
via the event type.</p>
</p>
<table class="basic-info">
  <tr>
   <th>Rate-limited:</th>
   <td>No</td>
  </tr>
 <tr>
  <th>Requires authentication:</th>
  <td>Yes</td>
 </tr>
</table>
<hr/>
<h2>Request</h2>
<h3>Request parameters</h3>
<table class="object-table">
 <caption>path parameters</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>txnId</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The transaction ID for this set of events. Homeservers generate
these IDs and they are used to ensure idempotency of requests.</td>
 </tr>
</table>
<h3>Request body</h3>
<table class="object-table">
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>events</code></td>
  <td><code>[ClientEvent]</code></td>
  <td>
    <strong>Required: </strong>A list of events, formatted as per the Client-Server API.</td>
 </tr>
</table>
<table id="_matrixappv1transactionstxnid_clientevent" class="object-table">
 <caption>ClientEvent</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>content</code></td>
  <td><code>object</code></td>
  <td>
    <strong>Required: </strong>The body of this event, as created by the client which sent it.</td>
 </tr>
 <tr>
  <td><code>event_id</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The globally unique identifier for this event.</td>
 </tr>
 <tr>
  <td><code>origin_server_ts</code></td>
  <td><code>integer</code></td>
  <td>
    <strong>Required: </strong>Timestamp (in milliseconds since the unix epoch) on originating homeserver
when this event was sent.</td>
 </tr>
 <tr>
  <td><code>room_id</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The ID of the room associated with this event.</td>
 </tr>
 <tr>
  <td><code>sender</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>Contains the fully-qualified ID of the user who sent this event.</td>
 </tr>
 <tr>
  <td><code>state_key</code></td>
  <td><code>string</code></td>
  <td>
    <p>Present if, and only if, this event is a <em>state</em> event. The key making
this piece of state unique in the room. Note that it is often an empty
string.</p>
<p>State keys starting with an <code>@</code> are reserved for referencing user IDs, such
as room members. With the exception of a few events, state events set with a
given user&rsquo;s ID as the state key MUST only be set by that user.</p>
</td>
 </tr>
 <tr>
  <td><code>type</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The type of the event.</td>
 </tr>
 <tr>
  <td><code>unsigned</code></td>
  <td><code>UnsignedData</code></td>
  <td>
    Contains optional extra information about the event.</td>
 </tr>
</table>
<table id="_matrixappv1transactionstxnid_unsigneddata" class="object-table">
 <caption>UnsignedData</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>age</code></td>
  <td><code>integer</code></td>
  <td>
    The time in milliseconds that has elapsed since the event was sent. This field is generated by the local homeserver, and may be incorrect if the local time on at least one of the two servers is out of sync, which can cause the age to either be negative or greater than it actually is.</td>
 </tr>
 <tr>
  <td><code>prev_content</code></td>
  <td><code>EventContent</code></td>
  <td>
    The previous <code>content</code> for this event. This field is generated
by the local homeserver, and is only returned if the event is a state event,
and the client has permission to see the previous content.<br><br>
    <strong>
      Changed in <code>v1.2</code>:
    </strong>
    Previously, this field was specified at the top level of returned
events rather than in <code>unsigned</code> (with the exception of the <a href="/client-server-api/#get_matrixclientv3notifications"><code>GET .../notifications</code></a>
endpoint), though in practice no known server implementations honoured
this.
</td>
 </tr>
 <tr>
  <td><code>redacted_because</code></td>
  <td><code>ClientEvent</code></td>
  <td>
    The event that redacted this event, if any.</td>
 </tr>
 <tr>
  <td><code>transaction_id</code></td>
  <td><code>string</code></td>
  <td>
    The client-supplied <a href="/client-server-api/#transaction-identifiers">transaction ID</a>, for example, provided via
<code>PUT /_matrix/client/v3/rooms/{roomId}/send/{eventType}/{txnId}</code>,
if the client being given the event is the same one which sent it.</td>
 </tr>
</table>
<h3>Request body example</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;events&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;content&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;avatar_url&#34;</span><span class="p">:</span> <span class="s2">&#34;mxc://example.org/SEsfnsuifSDFSSEF&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;displayname&#34;</span><span class="p">:</span> <span class="s2">&#34;Alice Margatroid&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;membership&#34;</span><span class="p">:</span> <span class="s2">&#34;join&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;reason&#34;</span><span class="p">:</span> <span class="s2">&#34;Looking for support&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;event_id&#34;</span><span class="p">:</span> <span class="s2">&#34;$143273582443PhrSn:example.org&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;origin_server_ts&#34;</span><span class="p">:</span> <span class="mi">1432735824653</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;room_id&#34;</span><span class="p">:</span> <span class="s2">&#34;!jEsUZKDJdhlrceRyVU:example.org&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;sender&#34;</span><span class="p">:</span> <span class="s2">&#34;@example:example.org&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;state_key&#34;</span><span class="p">:</span> <span class="s2">&#34;@alice:example.org&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;m.room.member&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;unsigned&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">1234</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;content&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;body&#34;</span><span class="p">:</span> <span class="s2">&#34;This is an example text message&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;format&#34;</span><span class="p">:</span> <span class="s2">&#34;org.matrix.custom.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;formatted_body&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;b&gt;This is an example text message&lt;/b&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;msgtype&#34;</span><span class="p">:</span> <span class="s2">&#34;m.text&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;event_id&#34;</span><span class="p">:</span> <span class="s2">&#34;$143273582443PhrSn:example.org&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;origin_server_ts&#34;</span><span class="p">:</span> <span class="mi">1432735824653</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;room_id&#34;</span><span class="p">:</span> <span class="s2">&#34;!jEsUZKDJdhlrceRyVU:example.org&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;sender&#34;</span><span class="p">:</span> <span class="s2">&#34;@example:example.org&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;m.room.message&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;unsigned&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">1234</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><hr/>
<h2>Responses</h2>
<table class="response-table">
 <thead>
  <th class="col-status">Status</th>
  <th class="col-status-description">Description</th>
 </thead>
 <tr>
  <td><code>200</code></td>
  <td>The transaction was processed successfully.</td>
 </tr>
</table>
<h3>200 response</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{}</span>
</span></span></code></pre></div></details>
</section>
<h4 id="pinging">Pinging</h4>
<p><span><strong>[Added in <code>v1.7</code>]</strong></span></p>
<p>The application service API includes a ping mechanism to allow
appservices to ensure that the homeserver can reach the appservice.
Appservices may use this mechanism to detect misconfigurations and
report them appropriately.</p>
<p>Implementations using this mechanism should take care to not fail
entirely in the event of temporary issues, e.g. gracefully handling
cases where the appservice is started before the homeserver.</p>
<p>The mechanism works as follows (note: the human-readable <code>error</code> fields
have been omitted for brevity):</p>
<p><strong>Typical</strong></p>
<pre tabindex="0"><code>AS ---&gt; HS : /_matrix/client/v1/appservice/{appserviceId}/ping {&#34;transaction_id&#34;: &#34;meow&#34;}
    HS ---&gt; AS : /_matrix/app/v1/ping {&#34;transaction_id&#34;: &#34;meow&#34;}
    HS &lt;--- AS : 200 OK {}
AS &lt;--- HS : 200 OK {&#34;duration_ms&#34;: 123}
</code></pre><p><strong>Incorrect <code>hs_token</code></strong></p>
<pre tabindex="0"><code>AS ---&gt; HS : /_matrix/client/v1/appservice/{appserviceId}/ping {&#34;transaction_id&#34;: &#34;meow&#34;}
    HS ---&gt; AS : /_matrix/app/v1/ping {&#34;transaction_id&#34;: &#34;meow&#34;}
    HS &lt;--- AS : 403 Forbidden {&#34;errcode&#34;: &#34;M_FORBIDDEN&#34;}
AS &lt;--- HS : 502 Bad Gateway {&#34;errcode&#34;: &#34;M_BAD_STATUS&#34;, &#34;status&#34;: 403, &#34;body&#34;: &#34;{\&#34;errcode\&#34;: \&#34;M_FORBIDDEN\&#34;}&#34;}
</code></pre><p><strong>Can&rsquo;t connect to appservice</strong></p>
<pre tabindex="0"><code>AS ---&gt; HS : /_matrix/client/v1/appservice/{appserviceId}/ping {&#34;transaction_id&#34;: &#34;meow&#34;}
    HS -/-&gt; AS : /_matrix/app/v1/ping {&#34;transaction_id&#34;: &#34;meow&#34;}
AS &lt;--- HS : 502 Bad Gateway {&#34;errcode&#34;: &#34;M_CONNECTION_FAILED&#34;}
</code></pre><p>The <code>/_matrix/app/v1/ping</code> endpoint is described here. The
<a href="#post_matrixclientv1appserviceappserviceidping"><code>/_matrix/client/v1/appservice/{appserviceId}/ping</code></a>
endpoint is under the Client-Server API extensions section below.</p>
<section class="rendered-data http-api POST">
<details open>
<summary>
  <h1 id="post_matrixappv1ping">
   <span class="http-api-method POST">POST</span>
   <span class="endpoint">/_matrix/app/v1/ping</span>
  </h1>
</summary>
  <hr/>
<p><strong>Added in <code>v1.7</code></strong></p>
<p><p>This API is called by the homeserver to ensure that the connection works
and the <code>hs_token</code> the homeserver has is correct.</p>
<p>Currently this is only called by the homeserver as a direct result of
the application service calling
<a href="#post_matrixclientv1appserviceappserviceidping"><code>POST /_matrix/client/v1/appservice/{appserviceId}/ping</code></a>.</p>
</p>
<table class="basic-info">
  <tr>
   <th>Rate-limited:</th>
   <td>No</td>
  </tr>
 <tr>
  <th>Requires authentication:</th>
  <td>Yes</td>
 </tr>
</table>
<hr/>
<h2>Request</h2>
<h3>Request body</h3>
<table class="object-table">
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>transaction_id</code></td>
  <td><code>string</code></td>
  <td>
    A transaction ID for the ping, copied directly from the
<code>POST /_matrix/client/v1/appservice/{appserviceId}/ping</code> call.</td>
 </tr>
</table>
<h3>Request body example</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;transaction_id&#34;</span><span class="p">:</span> <span class="s2">&#34;mautrix-go_1683636478256400935_123&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><hr/>
<h2>Responses</h2>
<table class="response-table">
 <thead>
  <th class="col-status">Status</th>
  <th class="col-status-description">Description</th>
 </thead>
 <tr>
  <td><code>200</code></td>
  <td>The provided <code>hs_token</code> is valid and the ping request was successful.</td>
 </tr>
</table>
<h3>200 response</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{}</span>
</span></span></code></pre></div></details>
</section>
<h4 id="querying">Querying</h4>
<p>The application service API includes two querying APIs: for room aliases
and for user IDs. The application service SHOULD create the queried
entity if it desires. During this process, the application service is
blocking the homeserver until the entity is created and configured. If
the homeserver does not receive a response to this request, the
homeserver should retry several times before timing out. This should
result in an HTTP status 408 &ldquo;Request Timeout&rdquo; on the client which
initiated this request (e.g. to join a room alias).</p>
<div class="alert rationale " role="alert">
Blocking the homeserver and expecting the application service to create
the entity using the client-server API is simpler and more flexible than
alternative methods such as returning an initial sync style JSON blob
and get the HS to provision the room/user. This also meant that there
didn&rsquo;t need to be a &ldquo;backchannel&rdquo; to inform the application service
about information about the entity such as room ID to room alias
mappings.
</div>
<section class="rendered-data http-api GET">
<details open>
<summary>
  <h1 id="get_matrixappv1usersuserid">
   <span class="http-api-method GET">GET</span>
   <span class="endpoint">/_matrix/app/v1/users/{userId}</span>
  </h1>
</summary>
  <hr/>
<p>This endpoint is invoked by the homeserver on an application service to query
the existence of a given user ID. The homeserver will only query user IDs
inside the application service&rsquo;s <code>users</code> namespace. The homeserver will
send this request when it receives an event for an unknown user ID in
the application service&rsquo;s namespace, such as a room invite.</p>
<table class="basic-info">
  <tr>
   <th>Rate-limited:</th>
   <td>No</td>
  </tr>
 <tr>
  <th>Requires authentication:</th>
  <td>Yes</td>
 </tr>
</table>
<hr/>
<h2>Request</h2>
<h3>Request parameters</h3>
<table class="object-table">
 <caption>path parameters</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>userId</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The user ID being queried.</td>
 </tr>
</table>
<hr/>
<h2>Responses</h2>
<table class="response-table">
 <thead>
  <th class="col-status">Status</th>
  <th class="col-status-description">Description</th>
 </thead>
 <tr>
  <td><code>200</code></td>
  <td>The application service indicates that this user exists. The application
service MUST create the user using the client-server API.</td>
 </tr>
 <tr>
  <td><code>401</code></td>
  <td>The homeserver has not supplied credentials to the application service.
Optional error information can be included in the body of this response.</td>
 </tr>
 <tr>
  <td><code>403</code></td>
  <td>The credentials supplied by the homeserver were rejected.</td>
 </tr>
 <tr>
  <td><code>404</code></td>
  <td>The application service indicates that this user does not exist.
Optional error information can be included in the body of this response.</td>
 </tr>
</table>
<h3>200 response</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{}</span>
</span></span></code></pre></div><h3>401 response</h3>
<table id="_matrixappv1usersuserid_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>403 response</h3>
<table id="_matrixappv1usersuserid_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_FORBIDDEN&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>404 response</h3>
<table id="_matrixappv1usersuserid_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_NOT_FOUND&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
</section>
<section class="rendered-data http-api GET">
<details open>
<summary>
  <h1 id="get_matrixappv1roomsroomalias">
   <span class="http-api-method GET">GET</span>
   <span class="endpoint">/_matrix/app/v1/rooms/{roomAlias}</span>
  </h1>
</summary>
  <hr/>
<p>This endpoint is invoked by the homeserver on an application service to query
the existence of a given room alias. The homeserver will only query room
aliases inside the application service&rsquo;s <code>aliases</code> namespace. The
homeserver will send this request when it receives a request to join a
room alias within the application service&rsquo;s namespace.</p>
<table class="basic-info">
  <tr>
   <th>Rate-limited:</th>
   <td>No</td>
  </tr>
 <tr>
  <th>Requires authentication:</th>
  <td>Yes</td>
 </tr>
</table>
<hr/>
<h2>Request</h2>
<h3>Request parameters</h3>
<table class="object-table">
 <caption>path parameters</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>roomAlias</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The room alias being queried.</td>
 </tr>
</table>
<hr/>
<h2>Responses</h2>
<table class="response-table">
 <thead>
  <th class="col-status">Status</th>
  <th class="col-status-description">Description</th>
 </thead>
 <tr>
  <td><code>200</code></td>
  <td>The application service indicates that this room alias exists. The
application service MUST have created a room and associated it with
the queried room alias using the client-server API. Additional
information about the room such as its name and topic can be set
before responding.</td>
 </tr>
 <tr>
  <td><code>401</code></td>
  <td>The homeserver has not supplied credentials to the application service.
Optional error information can be included in the body of this response.</td>
 </tr>
 <tr>
  <td><code>403</code></td>
  <td>The credentials supplied by the homeserver were rejected.</td>
 </tr>
 <tr>
  <td><code>404</code></td>
  <td>The application service indicates that this room alias does not exist.
Optional error information can be included in the body of this response.</td>
 </tr>
</table>
<h3>200 response</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{}</span>
</span></span></code></pre></div><h3>401 response</h3>
<table id="_matrixappv1roomsroomalias_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>403 response</h3>
<table id="_matrixappv1roomsroomalias_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_FORBIDDEN&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>404 response</h3>
<table id="_matrixappv1roomsroomalias_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_NOT_FOUND&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
</section>
<h4 id="third-party-networks">Third-party networks</h4>
<p>Application services may declare which protocols they support via their
registration configuration for the homeserver. These networks are
generally for third-party services such as IRC that the application
service is managing. Application services may populate a Matrix room
directory for their registered protocols, as defined in the
Client-Server API Extensions.</p>
<p>Each protocol may have several &ldquo;locations&rdquo; (also known as &ldquo;third-party
locations&rdquo; or &ldquo;3PLs&rdquo;). A location within a protocol is a place in the
third-party network, such as an IRC channel. Users of the third-party
network may also be represented by the application service.</p>
<p>Locations and users can be searched by fields defined by the application
service, such as by display name or other attribute. When clients
request the homeserver to search in a particular &ldquo;network&rdquo; (protocol),
the search fields will be passed along to the application service for
filtering.</p>
<section class="rendered-data http-api GET">
<details open>
<summary>
  <h1 id="get_matrixappv1thirdpartylocation">
   <span class="http-api-method GET">GET</span>
   <span class="endpoint">/_matrix/app/v1/thirdparty/location</span>
  </h1>
</summary>
  <hr/>
<p>Retrieve an array of third-party network locations from a Matrix room
alias.</p>
<table class="basic-info">
  <tr>
   <th>Rate-limited:</th>
   <td>No</td>
  </tr>
 <tr>
  <th>Requires authentication:</th>
  <td>Yes</td>
 </tr>
</table>
<hr/>
<h2>Request</h2>
<h3>Request parameters</h3>
<table class="object-table">
 <caption>query parameters</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>alias</code></td>
  <td><code>string</code></td>
  <td>
    The Matrix room alias to look up.</td>
 </tr>
</table>
<hr/>
<h2>Responses</h2>
<table class="response-table">
 <thead>
  <th class="col-status">Status</th>
  <th class="col-status-description">Description</th>
 </thead>
 <tr>
  <td><code>200</code></td>
  <td>All found third-party locations.</td>
 </tr>
 <tr>
  <td><code>401</code></td>
  <td>The homeserver has not supplied credentials to the application service.
Optional error information can be included in the body of this response.</td>
 </tr>
 <tr>
  <td><code>403</code></td>
  <td>The credentials supplied by the homeserver were rejected.</td>
 </tr>
 <tr>
  <td><code>404</code></td>
  <td>No mappings were found with the given parameters.</td>
 </tr>
</table>
<h3>200 response</h3>
<p>Array of <code>Location</code>.</p>
<table id="_matrixappv1thirdpartylocation_location" class="object-table">
 <caption>Location</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>alias</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An alias for a matrix room.</td>
 </tr>
 <tr>
  <td><code>fields</code></td>
  <td><code>object</code></td>
  <td>
    <strong>Required: </strong>Information used to identify this third-party location.</td>
 </tr>
 <tr>
  <td><code>protocol</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The protocol ID that the third-party location is a part of.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;alias&#34;</span><span class="p">:</span> <span class="s2">&#34;#freenode_#matrix:matrix.org&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;fields&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;channel&#34;</span><span class="p">:</span> <span class="s2">&#34;#matrix&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="s2">&#34;freenode&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;irc&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><h3>401 response</h3>
<table id="_matrixappv1thirdpartylocation_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>403 response</h3>
<table id="_matrixappv1thirdpartylocation_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_FORBIDDEN&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>404 response</h3>
<table id="_matrixappv1thirdpartylocation_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_NOT_FOUND&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
</section>
<section class="rendered-data http-api GET">
<details open>
<summary>
  <h1 id="get_matrixappv1thirdpartylocationprotocol">
   <span class="http-api-method GET">GET</span>
   <span class="endpoint">/_matrix/app/v1/thirdparty/location/{protocol}</span>
  </h1>
</summary>
  <hr/>
<p>Retrieve a list of Matrix portal rooms that lead to the matched third-party location.</p>
<table class="basic-info">
  <tr>
   <th>Rate-limited:</th>
   <td>No</td>
  </tr>
 <tr>
  <th>Requires authentication:</th>
  <td>Yes</td>
 </tr>
</table>
<hr/>
<h2>Request</h2>
<h3>Request parameters</h3>
<table class="object-table">
 <caption>path parameters</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>protocol</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The protocol ID.</td>
 </tr>
</table>
<table class="object-table">
 <caption>query parameters</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>fields</code></td>
  <td><code>{string: string}</code></td>
  <td>
    One or more custom fields that are passed to the application
service to help identify the third-party location.</td>
 </tr>
</table>
<hr/>
<h2>Responses</h2>
<table class="response-table">
 <thead>
  <th class="col-status">Status</th>
  <th class="col-status-description">Description</th>
 </thead>
 <tr>
  <td><code>200</code></td>
  <td>At least one portal room was found.</td>
 </tr>
 <tr>
  <td><code>401</code></td>
  <td>The homeserver has not supplied credentials to the application service.
Optional error information can be included in the body of this response.</td>
 </tr>
 <tr>
  <td><code>403</code></td>
  <td>The credentials supplied by the homeserver were rejected.</td>
 </tr>
 <tr>
  <td><code>404</code></td>
  <td>No mappings were found with the given parameters.</td>
 </tr>
</table>
<h3>200 response</h3>
<p>Array of <code>Location</code>.</p>
<table id="_matrixappv1thirdpartylocationprotocol_location" class="object-table">
 <caption>Location</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>alias</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An alias for a matrix room.</td>
 </tr>
 <tr>
  <td><code>fields</code></td>
  <td><code>object</code></td>
  <td>
    <strong>Required: </strong>Information used to identify this third-party location.</td>
 </tr>
 <tr>
  <td><code>protocol</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The protocol ID that the third-party location is a part of.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;alias&#34;</span><span class="p">:</span> <span class="s2">&#34;#freenode_#matrix:matrix.org&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;fields&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;channel&#34;</span><span class="p">:</span> <span class="s2">&#34;#matrix&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="s2">&#34;freenode&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;irc&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><h3>401 response</h3>
<table id="_matrixappv1thirdpartylocationprotocol_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>403 response</h3>
<table id="_matrixappv1thirdpartylocationprotocol_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_FORBIDDEN&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>404 response</h3>
<table id="_matrixappv1thirdpartylocationprotocol_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_NOT_FOUND&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
</section>
<section class="rendered-data http-api GET">
<details open>
<summary>
  <h1 id="get_matrixappv1thirdpartyprotocolprotocol">
   <span class="http-api-method GET">GET</span>
   <span class="endpoint">/_matrix/app/v1/thirdparty/protocol/{protocol}</span>
  </h1>
</summary>
  <hr/>
<p>This API is called by the homeserver when it wants to present clients
with specific information about the various third-party networks that
an application service supports.</p>
<table class="basic-info">
  <tr>
   <th>Rate-limited:</th>
   <td>No</td>
  </tr>
 <tr>
  <th>Requires authentication:</th>
  <td>Yes</td>
 </tr>
</table>
<hr/>
<h2>Request</h2>
<h3>Request parameters</h3>
<table class="object-table">
 <caption>path parameters</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>protocol</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The protocol ID.</td>
 </tr>
</table>
<hr/>
<h2>Responses</h2>
<table class="response-table">
 <thead>
  <th class="col-status">Status</th>
  <th class="col-status-description">Description</th>
 </thead>
 <tr>
  <td><code>200</code></td>
  <td>The protocol was found and metadata returned.</td>
 </tr>
 <tr>
  <td><code>401</code></td>
  <td>The homeserver has not supplied credentials to the application service.
Optional error information can be included in the body of this response.</td>
 </tr>
 <tr>
  <td><code>403</code></td>
  <td>The credentials supplied by the homeserver were rejected.</td>
 </tr>
 <tr>
  <td><code>404</code></td>
  <td>No protocol was found with the given path.</td>
 </tr>
</table>
<h3>200 response</h3>
<table id="_matrixappv1thirdpartyprotocolprotocol_protocol" class="object-table">
 <caption>Protocol</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>field_types</code></td>
  <td><code>{string: Field Type}</code></td>
  <td>
    <strong>Required: </strong><p>The type definitions for the fields defined in the <code>user_fields</code> and
<code>location_fields</code>. Each entry in those arrays MUST have an entry here. The
<code>string</code> key for this object is field name itself.</p>
<p>May be an empty object if no fields are defined.</p>
</td>
 </tr>
 <tr>
  <td><code>icon</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>A content URI representing an icon for the third-party protocol.</td>
 </tr>
 <tr>
  <td><code>instances</code></td>
  <td><code>[Protocol Instance]</code></td>
  <td>
    <strong>Required: </strong>A list of objects representing independent instances of configuration.
For example, multiple networks on IRC if multiple are provided by the
same application service.</td>
 </tr>
 <tr>
  <td><code>location_fields</code></td>
  <td><code>[string]</code></td>
  <td>
    <strong>Required: </strong>Fields which may be used to identify a third-party location. These should be
ordered to suggest the way that entities may be grouped, where higher
groupings are ordered first. For example, the name of a network should be
searched before the name of a channel.</td>
 </tr>
 <tr>
  <td><code>user_fields</code></td>
  <td><code>[string]</code></td>
  <td>
    <strong>Required: </strong>Fields which may be used to identify a third-party user. These should be
ordered to suggest the way that entities may be grouped, where higher
groupings are ordered first. For example, the name of a network should be
searched before the nickname of a user.</td>
 </tr>
</table>
<table id="_matrixappv1thirdpartyprotocolprotocol_field-type" class="object-table">
 <caption>Field Type</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>placeholder</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An placeholder serving as a valid example of the field value.</td>
 </tr>
 <tr>
  <td><code>regexp</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>A regular expression for validation of a field&rsquo;s value. This may be relatively
coarse to verify the value as the application service providing this protocol
may apply additional validation or filtering.</td>
 </tr>
</table>
<table id="_matrixappv1thirdpartyprotocolprotocol_protocol-instance" class="object-table">
 <caption>Protocol Instance</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>desc</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>A human-readable description for the protocol, such as the name.</td>
 </tr>
 <tr>
  <td><code>fields</code></td>
  <td><code>object</code></td>
  <td>
    <strong>Required: </strong>Preset values for <code>fields</code> the client may use to search by.</td>
 </tr>
 <tr>
  <td><code>icon</code></td>
  <td><code>string</code></td>
  <td>
    An optional content URI representing the protocol. Overrides the one provided
at the higher level Protocol object.</td>
 </tr>
 <tr>
  <td><code>network_id</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>A unique identifier across all instances.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;field_types&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;channel&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;placeholder&#34;</span><span class="p">:</span> <span class="s2">&#34;#foobar&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;regexp&#34;</span><span class="p">:</span> <span class="s2">&#34;#[^\\s]+&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;placeholder&#34;</span><span class="p">:</span> <span class="s2">&#34;irc.example.org&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;regexp&#34;</span><span class="p">:</span> <span class="s2">&#34;([a-z0-9]+\\.)*[a-z0-9]+&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;nickname&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;placeholder&#34;</span><span class="p">:</span> <span class="s2">&#34;username&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;regexp&#34;</span><span class="p">:</span> <span class="s2">&#34;[^\\s#]+&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;icon&#34;</span><span class="p">:</span> <span class="s2">&#34;mxc://example.org/aBcDeFgH&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;instances&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;desc&#34;</span><span class="p">:</span> <span class="s2">&#34;Freenode&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;fields&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="s2">&#34;freenode&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;icon&#34;</span><span class="p">:</span> <span class="s2">&#34;mxc://example.org/JkLmNoPq&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;network_id&#34;</span><span class="p">:</span> <span class="s2">&#34;freenode&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;location_fields&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;network&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;channel&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;user_fields&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;network&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;nickname&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>401 response</h3>
<table id="_matrixappv1thirdpartyprotocolprotocol_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>403 response</h3>
<table id="_matrixappv1thirdpartyprotocolprotocol_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_FORBIDDEN&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>404 response</h3>
<table id="_matrixappv1thirdpartyprotocolprotocol_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_NOT_FOUND&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
</section>
<section class="rendered-data http-api GET">
<details open>
<summary>
  <h1 id="get_matrixappv1thirdpartyuser">
   <span class="http-api-method GET">GET</span>
   <span class="endpoint">/_matrix/app/v1/thirdparty/user</span>
  </h1>
</summary>
  <hr/>
<p>Retrieve an array of third-party users from a Matrix User ID.</p>
<table class="basic-info">
  <tr>
   <th>Rate-limited:</th>
   <td>No</td>
  </tr>
 <tr>
  <th>Requires authentication:</th>
  <td>Yes</td>
 </tr>
</table>
<hr/>
<h2>Request</h2>
<h3>Request parameters</h3>
<table class="object-table">
 <caption>query parameters</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>userid</code></td>
  <td><code>string</code></td>
  <td>
    The Matrix User ID to look up.</td>
 </tr>
</table>
<hr/>
<h2>Responses</h2>
<table class="response-table">
 <thead>
  <th class="col-status">Status</th>
  <th class="col-status-description">Description</th>
 </thead>
 <tr>
  <td><code>200</code></td>
  <td>An array of third-party users.</td>
 </tr>
 <tr>
  <td><code>401</code></td>
  <td>The homeserver has not supplied credentials to the application service.
Optional error information can be included in the body of this response.</td>
 </tr>
 <tr>
  <td><code>403</code></td>
  <td>The credentials supplied by the homeserver were rejected.</td>
 </tr>
 <tr>
  <td><code>404</code></td>
  <td>No mappings were found with the given parameters.</td>
 </tr>
</table>
<h3>200 response</h3>
<p>Array of <code>User</code>.</p>
<table id="_matrixappv1thirdpartyuser_user" class="object-table">
 <caption>User</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>fields</code></td>
  <td><code>object</code></td>
  <td>
    <strong>Required: </strong>Information used to identify this third-party location.</td>
 </tr>
 <tr>
  <td><code>protocol</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The protocol ID that the third-party location is a part of.</td>
 </tr>
 <tr>
  <td><code>userid</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>A Matrix User ID represting a third-party user.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;fields&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;user&#34;</span><span class="p">:</span> <span class="s2">&#34;jim&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;gitter&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;userid&#34;</span><span class="p">:</span> <span class="s2">&#34;@_gitter_jim:matrix.org&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><h3>401 response</h3>
<table id="_matrixappv1thirdpartyuser_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>403 response</h3>
<table id="_matrixappv1thirdpartyuser_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>404 response</h3>
<table id="_matrixappv1thirdpartyuser_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_NOT_FOUND&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
</section>
<section class="rendered-data http-api GET">
<details open>
<summary>
  <h1 id="get_matrixappv1thirdpartyuserprotocol">
   <span class="http-api-method GET">GET</span>
   <span class="endpoint">/_matrix/app/v1/thirdparty/user/{protocol}</span>
  </h1>
</summary>
  <hr/>
<p>This API is called by the homeserver in order to retrieve a Matrix
User ID linked to a user on the third-party network, given a set of
user parameters.</p>
<table class="basic-info">
  <tr>
   <th>Rate-limited:</th>
   <td>No</td>
  </tr>
 <tr>
  <th>Requires authentication:</th>
  <td>Yes</td>
 </tr>
</table>
<hr/>
<h2>Request</h2>
<h3>Request parameters</h3>
<table class="object-table">
 <caption>path parameters</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>protocol</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The protocol ID.</td>
 </tr>
</table>
<table class="object-table">
 <caption>query parameters</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>fields</code></td>
  <td><code>{string: string}</code></td>
  <td>
    One or more custom fields that are passed to the application
service to help identify the user.</td>
 </tr>
</table>
<hr/>
<h2>Responses</h2>
<table class="response-table">
 <thead>
  <th class="col-status">Status</th>
  <th class="col-status-description">Description</th>
 </thead>
 <tr>
  <td><code>200</code></td>
  <td>The Matrix User IDs found with the given parameters.</td>
 </tr>
 <tr>
  <td><code>401</code></td>
  <td>The homeserver has not supplied credentials to the application service.
Optional error information can be included in the body of this response.</td>
 </tr>
 <tr>
  <td><code>403</code></td>
  <td>The credentials supplied by the homeserver were rejected.</td>
 </tr>
 <tr>
  <td><code>404</code></td>
  <td>No users were found with the given parameters.</td>
 </tr>
</table>
<h3>200 response</h3>
<p>Array of <code>User</code>.</p>
<table id="_matrixappv1thirdpartyuserprotocol_user" class="object-table">
 <caption>User</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>fields</code></td>
  <td><code>object</code></td>
  <td>
    <strong>Required: </strong>Information used to identify this third-party location.</td>
 </tr>
 <tr>
  <td><code>protocol</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The protocol ID that the third-party location is a part of.</td>
 </tr>
 <tr>
  <td><code>userid</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>A Matrix User ID represting a third-party user.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;fields&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;user&#34;</span><span class="p">:</span> <span class="s2">&#34;jim&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;gitter&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;userid&#34;</span><span class="p">:</span> <span class="s2">&#34;@_gitter_jim:matrix.org&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><h3>401 response</h3>
<table id="_matrixappv1thirdpartyuserprotocol_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>403 response</h3>
<table id="_matrixappv1thirdpartyuserprotocol_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_FORBIDDEN&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>404 response</h3>
<table id="_matrixappv1thirdpartyuserprotocol_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;COM.EXAMPLE.MYAPPSERVICE_NOT_FOUND&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
</section>
<h3 id="client-server-api-extensions">Client-Server API Extensions</h3>
<p>Application services can use a more powerful version of the
client-server API by identifying itself as an application service to the
homeserver.</p>
<p>Endpoints defined in this section MUST be supported by homeservers in
the client-server API as accessible only by application services.</p>
<h4 id="identity-assertion">Identity assertion</h4>
<p>The client-server API infers the user ID from the <code>access_token</code>
provided in every request. To avoid the application service from having
to keep track of each user&rsquo;s access token, the application service
should identify itself to the Client-Server API by providing its
<code>as_token</code> for the <code>access_token</code> alongside the user the application
service would like to masquerade as.</p>
<p>Inputs:</p>
<ul>
<li>Application service token (<code>as_token</code>)</li>
<li>User ID in the AS namespace to act as.</li>
</ul>
<p>Notes:</p>
<ul>
<li>This applies to all aspects of the Client-Server API, except for
Account Management.</li>
<li>The <code>as_token</code> is inserted into <code>access_token</code> which is usually
where the client token is, such as via the query string or
<code>Authorization</code> header. This is done on purpose to allow application
services to reuse client SDKs.</li>
<li>The <code>access_token</code> should be supplied through the <code>Authorization</code>
header where possible to prevent the token appearing in HTTP request
logs by accident.</li>
</ul>
<p>The application service may specify the virtual user to act as through
use of a <code>user_id</code> query string parameter on the request. The user
specified in the query string must be covered by one of the application
service&rsquo;s <code>user</code> namespaces. If the parameter is missing, the homeserver
is to assume the application service intends to act as the user implied
by the <code>sender_localpart</code> property of the registration.</p>
<p>An example request would be:</p>
<pre><code>GET /_matrix/client/v3/account/whoami?user_id=@_irc_user:example.org
Authorization: Bearer YourApplicationServiceTokenHere
</code></pre>
<h4 id="timestamp-massaging">Timestamp massaging</h4>
<p><span><strong>[Added in <code>v1.3</code>]</strong></span></p>
<p>Application services can alter the timestamp associated with an event, allowing
the application service to better represent the &ldquo;real&rdquo; time an event was sent
at. While this doesn&rsquo;t affect the server-side ordering of the event, it can allow
an application service to better represent when an event would have been sent/received
at, such as in the case of bridges where the remote network might have a slight
delay and the application service wishes to bridge the proper time onto the message.</p>
<p>When authenticating requests as an application service, the caller can append a <code>ts</code>
query string argument to change the <code>origin_server_ts</code> of the resulting event. Attempting
to set the timestamp to anything other than what is accepted by <code>origin_server_ts</code> should
be rejected by the server as a bad request.</p>
<p>When not present, the server&rsquo;s behaviour is unchanged: the local system time of the server
will be used to provide a timestamp, representing &ldquo;now&rdquo;.</p>
<p>The <code>ts</code> query string argument is only valid on the following endpoints:</p>
<ul>
<li><a href="/client-server-api/#put_matrixclientv3roomsroomidsendeventtypetxnid"><code>PUT /rooms/{roomId}/send/{eventType}/{txnId}</code></a></li>
<li><a href="/client-server-api/#put_matrixclientv3roomsroomidstateeventtypestatekey"><code>PUT /rooms/{roomId}/state/{eventType}/{stateKey}</code></a></li>
</ul>
<p>Other endpoints, such as <code>/kick</code>, do not support <code>ts</code>: instead, callers can use the
<code>PUT /state</code> endpoint to mimic the behaviour of the other APIs.</p>
<div class="alert warning " role="alert">
Changing the time of an event does not change the server-side (DAG) ordering for the
event. The event will still be appended at the tip of the DAG as though the timestamp
was set to &ldquo;now&rdquo;. Future MSCs, like <a href="https://github.com/matrix-org/matrix-spec-proposals/pull/2716">MSC2716</a>,
are expected to provide functionality which can allow DAG order manipulation (for history
imports and similar behaviour).
</div>
<h4 id="server-admin-style-permissions">Server admin style permissions</h4>
<p>The homeserver needs to give the application service <em>full control</em> over
its namespace, both for users and for room aliases. This means that the
AS should be able to manage any users and room alias in its namespace. No additional API
changes need to be made in order for control of room aliases to be
granted to the AS.</p>
<p>Creation of users needs API changes in order to:</p>
<ul>
<li>Work around captchas.</li>
<li>Have a &lsquo;passwordless&rsquo; user.</li>
</ul>
<p>This involves bypassing the registration flows entirely. This is
achieved by including the <code>as_token</code> on a <code>/register</code> request, along
with a login type of <code>m.login.application_service</code> to set the desired
user ID without a password.</p>
<pre><code>POST /_matrix/client/v3/register
Authorization: Bearer YourApplicationServiceTokenHere

Content:
{
  type: &quot;m.login.application_service&quot;,
  username: &quot;_irc_example&quot;
}
</code></pre>
<p>Similarly, logging in as users needs API changes in order to allow the AS to
log in without needing the user&rsquo;s password. This is achieved by including the
<code>as_token</code> on a <code>/login</code> request, along with a login type of
<code>m.login.application_service</code>:</p>
<p><span><strong>[Added in <code>v1.2</code>]</strong></span></p>
<pre><code>POST /_matrix/client/v3/login
Authorization: Bearer YourApplicationServiceTokenHere

Content:
{
  type: &quot;m.login.application_service&quot;,
  &quot;identifier&quot;: {
    &quot;type&quot;: &quot;m.id.user&quot;,
    &quot;user&quot;: &quot;_irc_example&quot;
  }
}
</code></pre>
<p>Application services which attempt to create users or aliases <em>outside</em>
of their defined namespaces, or log in as users outside of their defined
namespaces will receive an error code <code>M_EXCLUSIVE</code>.
Similarly, normal users who attempt to create users or aliases <em>inside</em>
an application service-defined namespace will receive the same
<code>M_EXCLUSIVE</code> error code, but only if the application service has
defined the namespace as <code>exclusive</code>.</p>
<h4 id="pinging-1">Pinging</h4>
<p><span><strong>[Added in <code>v1.7</code>]</strong></span></p>
<p>This is the client-server API companion endpoint for the
<a href="#pinging">pinging</a> mechanism described above.</p>
<section class="rendered-data http-api POST">
<details open>
<summary>
  <h1 id="post_matrixclientv1appserviceappserviceidping">
   <span class="http-api-method POST">POST</span>
   <span class="endpoint">/_matrix/client/v1/appservice/{appserviceId}/ping</span>
  </h1>
</summary>
  <hr/>
<p><strong>Added in <code>v1.7</code></strong></p>
<p><p>This API asks the homeserver to call the
<a href="#post_matrixappv1ping"><code>/_matrix/app/v1/ping</code></a> endpoint on the
application service to ensure that the homeserver can communicate
with the application service.</p>
<p>This API requires the use of an application service access token (<code>as_token</code>)
instead of a typical client&rsquo;s access token. This API cannot be invoked by
users who are not identified as application services. Additionally, the
appservice ID in the path must be the same as the appservice whose <code>as_token</code>
is being used.</p>
</p>
<table class="basic-info">
  <tr>
   <th>Rate-limited:</th>
   <td>No</td>
  </tr>
 <tr>
  <th>Requires authentication:</th>
  <td>Yes</td>
 </tr>
</table>
<hr/>
<h2>Request</h2>
<h3>Request parameters</h3>
<table class="object-table">
 <caption>path parameters</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>appserviceId</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The appservice ID of the appservice to ping. This must be the same
as the appservice whose <code>as_token</code> is being used to authenticate the
request.</td>
 </tr>
</table>
<h3>Request body</h3>
<table class="object-table">
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>transaction_id</code></td>
  <td><code>string</code></td>
  <td>
    An optional transaction ID that is passed through to the <code>/_matrix/app/v1/ping</code> call.</td>
 </tr>
</table>
<h3>Request body example</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;transaction_id&#34;</span><span class="p">:</span> <span class="s2">&#34;mautrix-go_1683636478256400935_123&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><hr/>
<h2>Responses</h2>
<table class="response-table">
 <thead>
  <th class="col-status">Status</th>
  <th class="col-status-description">Description</th>
 </thead>
 <tr>
  <td><code>200</code></td>
  <td>The ping was successful.</td>
 </tr>
 <tr>
  <td><code>400</code></td>
  <td>The application service doesn&rsquo;t have a URL configured. The errcode is <code>M_URL_NOT_SET</code>.</td>
 </tr>
 <tr>
  <td><code>403</code></td>
  <td>The access token used to authenticate the request doesn&rsquo;t belong to an appservice, or belongs to a different appservice than the one in the path. The errcode is <code>M_FORBIDDEN</code>.</td>
 </tr>
 <tr>
  <td><code>502</code></td>
  <td><p>The application service returned a bad status, or the connection failed.
The errcode is <code>M_BAD_STATUS</code> or <code>M_CONNECTION_FAILED</code>.</p>
<p>For bad statuses, the response may include <code>status</code> and <code>body</code>
fields containing the HTTP status code and response body text
respectively to aid with debugging.</p>
</td>
 </tr>
 <tr>
  <td><code>504</code></td>
  <td>The connection to the application service timed out. The errcode is <code>M_CONNECTION_TIMEOUT</code>.</td>
 </tr>
</table>
<h3>200 response</h3>
<table class="object-table">
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>duration_ms</code></td>
  <td><code>integer</code></td>
  <td>
    <strong>Required: </strong>The duration in milliseconds that the
<a href="#post_matrixappv1ping"><code>/_matrix/app/v1/ping</code></a>
request took from the homeserver&rsquo;s point of view.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;duration_ms&#34;</span><span class="p">:</span> <span class="mi">123</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>400 response</h3>
<table id="_matrixclientv1appserviceappserviceidping_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;M_URL_NOT_SET&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;Application service doesn&#39;t have a URL configured&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>403 response</h3>
<table id="_matrixclientv1appserviceappserviceidping_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;M_FORBIDDEN&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;Provided access token is not the appservice&#39;s as_token&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>502 response</h3>
<table id="_matrixclientv1appserviceappserviceidping_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>body</code></td>
  <td><code>string</code></td>
  <td>
    The HTTP response body returned by the appservice.</td>
 </tr>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.<p>One of: <code>[M_BAD_STATUS, M_CONNECTION_FAILED]</code>.</p></td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
 <tr>
  <td><code>status</code></td>
  <td><code>integer</code></td>
  <td>
    The HTTP status code returned by the appservice.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;body&#34;</span><span class="p">:</span> <span class="s2">&#34;{\&#34;errcode\&#34;: \&#34;M_UNKNOWN_TOKEN\&#34;}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;M_BAD_STATUS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;Ping returned status 401&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="mi">401</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3>504 response</h3>
<table id="_matrixclientv1appserviceappserviceidping_error" class="object-table">
 <caption>Error</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>errcode</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>An error code.</td>
 </tr>
 <tr>
  <td><code>error</code></td>
  <td><code>string</code></td>
  <td>
    A human-readable error message.</td>
 </tr>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;errcode&#34;</span><span class="p">:</span> <span class="s2">&#34;M_CONNECTION_TIMEOUT&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;Connection to application service timed out&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
</section>
<h4 id="using-sync-and-events">Using <code>/sync</code> and <code>/events</code></h4>
<p>Application services wishing to use <code>/sync</code> or <code>/events</code> from the
Client-Server API MUST do so with a virtual user (provide a <code>user_id</code>
via the query string). It is expected that the application service use
the transactions pushed to it to handle events rather than syncing with
the user implied by <code>sender_localpart</code>.</p>
<h4 id="application-service-room-directories">Application service room directories</h4>
<p>Application services can maintain their own room directories for their
defined third-party protocols. These room directories may be accessed by
clients through additional parameters on the <code>/publicRooms</code>
client-server endpoint.</p>
<section class="rendered-data http-api PUT">
<details open>
<summary>
  <h1 id="put_matrixclientv3directorylistappservicenetworkidroomid">
   <span class="http-api-method PUT">PUT</span>
   <span class="endpoint">/_matrix/client/v3/directory/list/appservice/{networkId}/{roomId}</span>
  </h1>
</summary>
  <hr/>
<p><p>Updates the visibility of a given room on the application service&rsquo;s room
directory.</p>
<p>This API is similar to the room directory visibility API used by clients
to update the homeserver&rsquo;s more general room directory.</p>
<p>This API requires the use of an application service access token (<code>as_token</code>)
instead of a typical client&rsquo;s access_token. This API cannot be invoked by
users who are not identified as application services.</p>
</p>
<table class="basic-info">
  <tr>
   <th>Rate-limited:</th>
   <td>No</td>
  </tr>
 <tr>
  <th>Requires authentication:</th>
  <td>Yes</td>
 </tr>
</table>
<hr/>
<h2>Request</h2>
<h3>Request parameters</h3>
<table class="object-table">
 <caption>path parameters</caption>
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>networkId</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The protocol (network) ID to update the room list for. This would
have been provided by the application service as being listed as
a supported protocol.</td>
 </tr>
 <tr>
  <td><code>roomId</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>The room ID to add to the directory.</td>
 </tr>
</table>
<h3>Request body</h3>
<table class="object-table">
 <thead>
  <th class="col-name">Name</th>
  <th class="col-type">Type</th>
  <th class="col-description">Description</th>
 </thead>
 <tr>
  <td><code>visibility</code></td>
  <td><code>string</code></td>
  <td>
    <strong>Required: </strong>Whether the room should be visible (public) in the directory
or not (private).<p>One of: <code>[public, private]</code>.</p></td>
 </tr>
</table>
<h3>Request body example</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;visibility&#34;</span><span class="p">:</span> <span class="s2">&#34;public&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><hr/>
<h2>Responses</h2>
<table class="response-table">
 <thead>
  <th class="col-status">Status</th>
  <th class="col-status-description">Description</th>
 </thead>
 <tr>
  <td><code>200</code></td>
  <td>The room&rsquo;s directory visibility has been updated.</td>
 </tr>
</table>
<h3>200 response</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{}</span>
</span></span></code></pre></div></details>
</section>
<h3 id="referencing-messages-from-a-third-party-network">Referencing messages from a third-party network</h3>
<p>Application services should include an <code>external_url</code> in the <code>content</code>
of events it emits to indicate where the message came from. This
typically applies to application services that bridge other networks
into Matrix, such as IRC, where an HTTP URL may be available to
reference.</p>
<p>Clients should provide users with a way to access the <code>external_url</code> if
it is present. Clients should additionally ensure the URL has a scheme
of <code>https</code> or <code>http</code> before making use of it.</p>
<p>The presence of an <code>external_url</code> on an event does not necessarily mean
the event was sent from an application service. Clients should be wary
of the URL contained within, as it may not be a legitimate reference to
the event&rsquo;s source.</p>

</div>


          </main>
        </div>
      </div>
      


<footer class="py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-12 text-center text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-dark" target="_blank" rel="noopener noreferrer" href="https://github.com/matrix-org">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitLab" aria-label="GitLab">
    <a class="text-dark" target="_blank" rel="noopener noreferrer" href="https://gitlab.matrix.org/matrix-org">
      <i class="fab fa-gitlab"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="YouTube" aria-label="YouTube">
    <a class="text-dark" target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/channel/UCVFkW-chclhuyYRbmmfwt6w">
      <i class="fab fa-youtube"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-dark" target="_blank" rel="noopener noreferrer" href="https://twitter.com/matrixdotorg">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
    </div>
    <div class="row">
      <div class="col-12 text-center py-2 order-sm-3">
        <small>&copy; 2023 The Matrix.org Foundation CIC</small>
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    

<script src="/js/main.min.be25a680a0d95dc8b5d6664622e2134aa894220e2f224ef609e00f633a3a1b32.js" integrity="sha256-viWmgKDZXci11mZGIuITSqiUIg4vIk72CeAPYzo6GzI=" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>


<script defer language="javascript" type="text/javascript"  src="/js/toc.js"></script>

  </body>
</html>
